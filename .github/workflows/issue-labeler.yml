name: Issue Auto Labeler

on:
  issues:
    types: [opened, edited]

jobs:
  label-issue:
    name: Auto Label Issue
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read

    steps:
      - name: Label based on issue content
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const issue = context.payload.issue;
            const title = issue.title.toLowerCase();
            const body = (issue.body || '').toLowerCase();
            const labels = [];

            // ä¼˜å…ˆçº§æ ‡ç­¾
            if (title.includes('[p0]') || body.includes('critical') || body.includes('urgent')) {
              labels.push('priority: critical');
            } else if (title.includes('[p1]') || body.includes('high priority')) {
              labels.push('priority: high');
            } else if (title.includes('[p2]')) {
              labels.push('priority: medium');
            } else if (title.includes('[p3]')) {
              labels.push('priority: low');
            }

            // ç±»å‹æ ‡ç­¾
            if (title.includes('bug') || title.includes('fix') || body.includes('bug')) {
              labels.push('type: bug', 'ğŸ› bug');
            } else if (title.includes('feature') || title.includes('feat') || body.includes('feature request')) {
              labels.push('type: feature', 'âœ¨ feature');
            } else if (title.includes('enhancement') || title.includes('improve')) {
              labels.push('type: enhancement', 'ğŸ“ˆ enhancement');
            } else if (title.includes('docs') || title.includes('documentation')) {
              labels.push('type: documentation', 'ğŸ“ documentation');
            } else if (title.includes('test')) {
              labels.push('type: test', 'ğŸ§ª test');
            } else if (title.includes('refactor')) {
              labels.push('type: refactor', 'ğŸ”„ refactor');
            } else if (title.includes('performance') || title.includes('perf')) {
              labels.push('type: performance', 'ğŸš€ performance');
            }

            // æ¨¡å—æ ‡ç­¾
            if (title.includes('[character]') || title.includes('character')) {
              labels.push('module: character', 'ğŸ­ character');
            }
            if (title.includes('[weapon]') || title.includes('weapon')) {
              labels.push('module: weapon', 'âš”ï¸ weapon');
            }
            if (title.includes('[artifact]') || title.includes('artifact')) {
              labels.push('module: artifact', 'ğŸ’ artifact');
            }
            if (title.includes('[monster]') || title.includes('monster')) {
              labels.push('module: monster', 'ğŸ‘¾ monster');
            }
            if (title.includes('[gallery]') || title.includes('gallery') || title.includes('image')) {
              labels.push('module: gallery', 'ğŸ–¼ï¸ gallery');
            }
            if (title.includes('[game mechanic]') || title.includes('game mechanic')) {
              labels.push('module: game mechanics', 'ğŸ“š game mechanics');
            }

            // å‰åç«¯æ ‡ç­¾
            if (title.includes('[frontend]') || body.includes('frontend')) {
              labels.push('ğŸ¨ frontend');
            }
            if (title.includes('[backend]') || body.includes('backend')) {
              labels.push('âš™ï¸ backend');
            }
            if (title.includes('[database]') || body.includes('database')) {
              labels.push('ğŸ—„ï¸ database');
            }
            if (title.includes('[infrastructure]') || body.includes('infrastructure') || body.includes('ci/cd')) {
              labels.push('ğŸ”§ infrastructure');
            }

            // ç‰¹æ®Šæ ‡ç­¾
            if (body.includes('good first issue') || title.includes('beginner')) {
              labels.push('good first issue');
            }
            if (body.includes('help wanted') || title.includes('help wanted')) {
              labels.push('help wanted');
            }
            if (body.includes('blocked') || title.includes('blocked')) {
              labels.push('blocked');
            }
            if (body.includes('security') || title.includes('security') || title.includes('vulnerability')) {
              labels.push('ğŸ” security');
            }

            // æ·»åŠ æ ‡ç­¾
            if (labels.length > 0) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                labels: labels
              });
            }

      - name: Add comment for new issues
        uses: actions/github-script@v7
        if: github.event.action == 'opened'
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const issue = context.payload.issue;

            const comment = `ğŸ‘‹ æ„Ÿè°¢æäº¤ Issue!

æˆ‘ä»¬å·²ç»è‡ªåŠ¨ä¸ºè¿™ä¸ª Issue æ·»åŠ äº†æ ‡ç­¾ã€‚å¼€å‘å›¢é˜Ÿä¼šå°½å¿«æŸ¥çœ‹å¹¶å›å¤ã€‚

**ä¸‹ä¸€æ­¥:**
- è¯·ç¡®ä¿æä¾›äº†è¶³å¤Ÿçš„ä¿¡æ¯æ¥é‡ç°é—®é¢˜(å¦‚æœæ˜¯ bug)
- æˆ–è€…è¯¦ç»†æè¿°äº†æ–°åŠŸèƒ½çš„éœ€æ±‚(å¦‚æœæ˜¯ feature)
- å¯ä»¥æ·»åŠ æˆªå›¾ã€æ—¥å¿—ç­‰è¡¥å……ä¿¡æ¯

**è´¡çŒ®æŒ‡å—:** å¦‚æœä½ æƒ³è‡ªå·±è§£å†³è¿™ä¸ªé—®é¢˜,æ¬¢è¿æäº¤ PR!

---
ğŸ¤– æ­¤æ¶ˆæ¯ç”± GitHub Actions è‡ªåŠ¨å‘é€`;

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              body: comment
            });
